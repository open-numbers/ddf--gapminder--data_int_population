# preprocessing ingredients

cooking:
    datapoints:
        # preprocessing: un data is in thousands and gapminder in ones,
        # so we need to multiple un data by 1000 first
        - procedure: run_op
          ingredients:
              - unpop-datapoints-pop-by-age
          options:
              op:
                  population: population * 1000
          result: unpop-datapoints-pop-by-age-thousands

        - procedure: run_op
          ingredients:
              - unpop-datapoints-pop-by-age-gender
          options:
              op:
                  population: population * 1000
          result: unpop-datapoints-pop-by-age-gender-thousands
          
        - procedure: filter_row
          ingredients:
              - unpop-datapoints-pop-by-age-thousands
          options:
              dictionary:
                  population:
                      from: population
                      country_code: '900'
              keep_all_columns: true
          result: unpop-datapoints-pop_world-by-age-thousands

        - procedure: filter_row
          ingredients:
              - unpop-datapoints-pop-by-age-gender-thousands
          options:
              dictionary:
                  population:
                      from: population
                      country_code: '900'
              keep_all_columns: true
          result: unpop-datapoints-pop_world-by-age-gender-thousands

        # align UN and gapminder entities to use gapminder geo
        - procedure: translate_column
          ingredients:
              - gmpop-entities-area
          options:
              column: name
              target_column: country
              dictionary:
                  base: gm-entities-country
                  key: ['gapminder_list', 'alternative_1', 'alternative_2', 'alternative_3',
                        'alternative_4_cdiac', 'pandg', 'god_id', 'alt_5', 'upper_case_name',
                        'arb1', 'arb2', 'arb3', 'arb4', 'arb5', 'arb6', 'name', 'iso3166_1_alpha2',
                        'iso3166_1_alpha3', 'iso3166_2'
                        ]
                  value: country
          result: gmpop-entities-area-aligned

        - procedure: translate_column
          ingredients:
              - unpop-entities-country_code
          options:
              column: name
              target_column: country
              dictionary:
                  base: gm-entities-country
                  key: ['gapminder_list', 'alternative_1', 'alternative_2', 'alternative_3',
                        'alternative_4_cdiac', 'pandg', 'god_id', 'alt_5', 'upper_case_name',
                        'arb1', 'arb2', 'arb3', 'arb4', 'arb5', 'arb6', 'name', 'iso3166_1_alpha2',
                        'iso3166_1_alpha3', 'iso3166_2'
                        ]
                  value: country
          result: unpop-entities-country_code-aligned
